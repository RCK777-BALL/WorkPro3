services:
  mongo:
    image: mongo:7
    restart: unless-stopped
    command: ["--auth"]
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD}
      MONGO_INITDB_DATABASE: workpro
    volumes:
      - mongo-data:/data/db
    networks: [workpro]

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    restart: unless-stopped
    environment:
      NODE_ENV: production
      PORT: 5010
      MONGO_URI: mongodb://${MONGO_APP_USERNAME}:${MONGO_APP_PASSWORD}@mongo:27017/workpro?authSource=admin
      JWT_SECRET: ${JWT_SECRET}
      CORS_ORIGIN: ${CORS_ORIGIN}
    depends_on: [mongo]
    ports:
      - "5010:5010"
    networks: [workpro]

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: ${VITE_API_URL}
        VITE_WS_URL: ${VITE_WS_URL}
        VITE_SOCKET_PATH: ${VITE_SOCKET_PATH:-/socket.io}
    restart: unless-stopped
    depends_on: [backend]
    ports:
      - "8080:80"
    networks: [workpro]

volumes:
  mongo-data:

networks:
  workpro:
